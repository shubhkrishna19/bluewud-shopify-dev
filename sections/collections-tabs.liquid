<section class="custom-html--container whisper-collections-tabs">
  <ul class="shopify-tabs whisper-collections-tabs__tabs" role="tablist">
    {% for block in section.blocks %}
    <li class="whisper-collections-tabs__tab-item">
      <button
        type="button"
        data-tab="tab-{{ block.id }}"
        id="tab-button-{{ block.id }}"
        class="collection__item-title whisper-collections-tabs__tab {% if forloop.first %} current{% endif %}"
        role="tab"
        aria-controls="tab-{{ block.id }}"
        aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
        tabindex="{% if forloop.first %}0{% else %}-1{% endif %}"
      >
        <span>{{ block.settings.title }}</span>
      </button>
    </li>
    {% endfor %}
  </ul>
  {% for block in section.blocks %}
  <div
    id="tab-{{ block.id }}"
    class="shopify-tab-content whisper-collections-tabs__panel {% if forloop.first %} current{% endif %}"
    role="tabpanel"
    aria-labelledby="tab-button-{{ block.id }}"
    {% if forloop.first == false %}tabindex="-1"{% endif %}
  >
    <div class="tab-rows whisper-collections-tabs__grid">
      {% for i in (1..8) %}
      {% capture blk_image %}image_{{ i }}{% endcapture %}
      {% capture blk_collection %}collection_{{ i }}{% endcapture %}
      {% capture blk_title %}title_{{ i }}{% endcapture %}

      {%- assign collection = block.settings[blk_collection] -%}
      {%- assign collection_image = block.settings[blk_image] | default: collection.image | default: collection.products.first.featured_image -%}
      {%- assign collection = collections[collection] -%}
      {% if block.settings[blk_collection] != blank %}
      
      <div class="tab-rows-column whisper-collections-tabs__item">
        <div class="tab-rows-column-wrap whisper-collections-tabs__item-wrap">
        <a href="{{ collection.url }}">
        <div class="tab-rows-column-img whisper-collections-tabs__item-media">
          {% if collection_image %}
          <div class="info-box-icon whisper-collections-tabs__item-thumb">
          <img src="{{ collection_image | img_url: '120x90', crop: 'center' }}" alt="{{ collection_image.alt }}">
          </div>
          {% endif %}
        </div>

        <div class="tab-rows-column-info whisper-collections-tabs__item-info">
          <span class="collection__item-title whisper-collections-tabs__item-title">
        {% if block.settings[blk_title] != blank %}
        {{ block.settings[blk_title] }}
        {% else %}
        {{ collection.title }}
        {% endif %}
          </span>
        </div>
          </a>
        </div>
      </div>
      
      {% endif %}
    {% endfor %}
    </div>
  </div>
  {% endfor %}
</section>

<style>
  #shopify-section-{{ section.id }} .info-box-icon {
    {% assign color_border = section.settings.border_color %}
    border: 1px solid {{ color_border | color_modify: 'alpha', 0.16 }};
    box-shadow: 0 1px 4px {{ color_border | color_modify: 'alpha', 0.11 }};
}
  #shopify-section-{{ section.id }} .info-box-icon:hover {
    border-color: {{ section.settings.border_color_hover }};
    box-shadow: -7px 6px 5px 0 rgb(0 0 0 / 21%);
}
</style>
<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', () => {
    const section = document.getElementById('shopify-section-{{ section.id }}');
    if (!section) {
      return;
    }
    const tabs = Array.from(section.querySelectorAll('.whisper-collections-tabs__tab'));
    const panels = Array.from(section.querySelectorAll('.shopify-tab-content'));

    const activateTab = (tab) => {
      const tabId = tab.getAttribute('data-tab');
      tabs.forEach((item) => {
        item.classList.remove('current');
        item.setAttribute('aria-selected', 'false');
        item.setAttribute('tabindex', '-1');
      });
      panels.forEach((panel) => panel.classList.remove('current'));
      tab.classList.add('current');
      tab.setAttribute('aria-selected', 'true');
      tab.setAttribute('tabindex', '0');
      const activePanel = section.querySelector(`#${tabId}`);
      if (activePanel) {
        activePanel.classList.add('current');
      }
    };

    tabs.forEach((tab, index) => {
      tab.addEventListener('click', () => {
        activateTab(tab);
        tab.focus();
      });

      tab.addEventListener('keydown', (event) => {
        const { key } = event;
        if (!['ArrowLeft', 'ArrowRight', 'Home', 'End'].includes(key)) {
          return;
        }
        event.preventDefault();
        let nextIndex = index;
        if (key === 'ArrowRight') {
          nextIndex = (index + 1) % tabs.length;
        }
        if (key === 'ArrowLeft') {
          nextIndex = (index - 1 + tabs.length) % tabs.length;
        }
        if (key === 'Home') {
          nextIndex = 0;
        }
        if (key === 'End') {
          nextIndex = tabs.length - 1;
        }
        const nextTab = tabs[nextIndex];
        if (nextTab) {
          activateTab(nextTab);
          nextTab.focus();
        }
      });
    });
  });
</script>

{% schema %}
  {
    "name": "Collections tabs",
	"max_blocks": 4,
    "settings": [
      {
        "type": "color",
        "id": "border_color",
        "label": "Boder Color",
		"default": "#f04f36"
      },
	  {
        "type": "color",
        "id": "border_color_hover",
        "label": "Boder Color Hover",
		"default": "#046173"
      }
	],
    "blocks": [
      {
        "type": "tab",
        "name": "Tab",
        "settings": [
		  {
            "type": "text",
            "id": "title",
            "label": "Tab Name",
            "default": "Furniture"
          },
		  {
            "type": "header",
            "content": "Collection 1"
          },
          {
            "type": "image_picker",
            "id": "image_1",
            "label": "Image",
            "info": "540 x 390px recommended"
          },
          {
            "type": "collection",
            "id": "collection_1",
            "label": "Collection"
          },
          {
            "type": "text",
            "id": "title_1",
            "label": "Collection Title"
          },
		  {
            "type": "header",
            "content": "Collection 2"
          },
          {
            "type": "image_picker",
            "id": "image_2",
            "label": "Image",
            "info": "540 x 390px recommended"
          },
          {
            "type": "collection",
            "id": "collection_2",
            "label": "Collection"
          },
          {
            "type": "text",
            "id": "title_2",
            "label": "Collection Title"
          },
		  {
            "type": "header",
            "content": "Collection 3"
          },
          {
            "type": "image_picker",
            "id": "image_3",
            "label": "Image",
            "info": "540 x 390px recommended"
          },
          {
            "type": "collection",
            "id": "collection_3",
            "label": "Collection"
          },
          {
            "type": "text",
            "id": "title_3",
            "label": "Collection Title"
          },
		  {
            "type": "header",
            "content": "Collection 4"
          },
          {
            "type": "image_picker",
            "id": "image_4",
            "label": "Image",
            "info": "540 x 390px recommended"
          },
          {
            "type": "collection",
            "id": "collection_4",
            "label": "Collection"
          },
          {
            "type": "text",
            "id": "title_4",
            "label": "Collection Title"
          },
		  {
            "type": "header",
            "content": "Collection 5"
          },
          {
            "type": "image_picker",
            "id": "image_5",
            "label": "Image",
            "info": "540 x 390px recommended"
          },
          {
            "type": "collection",
            "id": "collection_5",
            "label": "Collection"
          },
          {
            "type": "text",
            "id": "title_5",
            "label": "Collection Title"
          },
		  {
            "type": "header",
            "content": "Collection 6"
          },
          {
            "type": "image_picker",
            "id": "image_6",
            "label": "Image",
            "info": "540 x 390px recommended"
          },
          {
            "type": "collection",
            "id": "collection_6",
            "label": "Collection"
          },
          {
            "type": "text",
            "id": "title_6",
            "label": "Collection Title"
          },
		  {
            "type": "header",
            "content": "Collection 7"
          },
          {
            "type": "image_picker",
            "id": "image_7",
            "label": "Image",
            "info": "540 x 390px recommended"
          },
          {
            "type": "collection",
            "id": "collection_7",
            "label": "Collection"
          },
          {
            "type": "text",
            "id": "title_7",
            "label": "Collection Title"
          },
		  {
            "type": "header",
            "content": "Collection 8"
          },
          {
            "type": "image_picker",
            "id": "image_8",
            "label": "Image",
            "info": "540 x 390px recommended"
          },
          {
            "type": "collection",
            "id": "collection_8",
            "label": "Collection"
          },
          {
            "type": "text",
            "id": "title_8",
            "label": "Collection Title"
          }
        ]
      }
    ],
    "presets": [
      {
        "category": "Homepage",
        "name": "Collections tabs"
      }
    ]
  }
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}
