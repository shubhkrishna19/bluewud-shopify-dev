{% liquid
  # Porting Whisper Header logic to Empire Theme
  # Mapping Whisper snippets with 'whisper-' prefix
  
  assign order = 'menu_drawer,logo,menu,localization,search,mobile_search,actions'

  if shop.customer_accounts_enabled
    assign order = 'menu_drawer,mobile_search,logo,menu,localization,search,actions'
  endif

  assign rows = 'top,bottom' | split: ','
  assign search_style = 'none'

  if section.settings.show_search
    assign search_style = 'modal'
  endif

  if section.settings.enable_sticky_header == 'always'
    assign sticky = 'always'
  elsif section.settings.enable_sticky_header == 'scroll-up'
    assign sticky = 'scroll-up'
  endif

  # Functional Captures
  capture logo
    echo '<div class="header__column header__column--logo">'
    if section.settings.logo != blank
      assign logo_alt = section.settings.logo.alt | default: shop.name
      assign logo_height = section.settings.logo_height | default: 40
      assign logo_width = logo_height | times: section.settings.logo.aspect_ratio
      echo section.settings.logo | image_url: width: 400 | image_tag: class: 'header__logo-image', width: logo_width, height: logo_height, alt: logo_alt, preload: true
    else
      echo '<a href="/" class="header__logo-text">' | append: shop.name | append: '</a>'
    endif
    echo '</div>'
  endcapture

  capture menu
    <div ref="headerMenu">
      {% render 'woodenstreet-mega-menu', menu: linklists[section.settings.menu] %}
    </div>
  endcapture

  capture actions
    render 'whisper-header-actions'
  endcapture

  capture search
    render 'whisper-search', style: search_style
  endcapture

  capture localization_markup
    render 'whisper-localization-form'
  endcapture
%}

<header-component
  id="header-component"
  class="header header-wrapper--glass color-{{ section.settings.color_scheme_top }} spacing-style"
  style="{% render 'whisper-spacing-style', settings: section.settings %}"
  data-site-header
  {% if sticky %}
    sticky="{{ sticky }}"
  {% endif %}
>
  {% for row in rows %}
    {% liquid
       assign row_class = 'header__row header__row--' | append: row
       if row == 'bottom'
         assign row_class = row_class | append: ' mobile:hidden'
       endif
    %}
    <div 
      class="{{ row_class }} color-{{ section.settings.row_color_scheme }}"
      {% if row == 'top' %}ref="headerRowTop"{% endif %}
    >
       <div class="header__columns container-style">
          {% render 'whisper-header-row',
            row: row,
            order: order,
            settings: section.settings,
            logo: logo,
            menu: menu,
            actions: actions,
            localization: localization_markup,
            search: search
          %}
       </div>
    </div>
  {% endfor %}
</header-component>

<script src="{{ 'whisper-header.js' | asset_url }}" type="module"></script>
<script src="{{ 'whisper-header-menu.js' | asset_url }}" type="module"></script>



{% schema %}
{
  "name": "Whisper Header",
  "tag": "header",
  "class": "header-section",
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "range",
      "id": "logo_height",
      "min": 20,
      "max": 120,
      "step": 5,
      "unit": "px",
      "label": "Logo height",
      "default": 40
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    },
    {
      "type": "select",
      "id": "enable_sticky_header",
      "label": "Sticky Behavior",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "always", "label": "Always" },
        { "value": "scroll-up", "label": "On Scroll Up" }
      ],
      "default": "always"
    },
    {
      "type": "header",
      "content": "Aesthetics"
    },
    {
      "type": "select",
      "id": "color_scheme_top",
      "label": "Color Scheme",
      "options": [
        { "value": "default", "label": "Default" },
        { "value": "inverse", "label": "Inverse" }
      ],
      "default": "default"
    },
    {
      "type": "select",
      "id": "row_color_scheme",
      "label": "Row Color Scheme",
      "options": [
        { "value": "default", "label": "Default" },
        { "value": "accent", "label": "Accent" }
      ],
      "default": "default"
    },
    {
      "type": "header",
      "content": "Modular Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top Padding",
      "default": 12
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 12
    }
  ]
}
{% endschema %}
