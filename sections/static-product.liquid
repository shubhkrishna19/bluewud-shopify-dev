<script
  type="application/json"
  data-section-type="static-product"
  data-section-id="{{ section.id }}"
  data-section-data
>
  {
    "settings": {
      "cart_redirection": {{ settings.enable_cart_redirection | json }},
      "gallery_thumbnail_position": {{ section.settings.gallery_thumbnail_position | json }},
      "gallery_video_autoplay": {{ section.settings.gallery_video_autoplay | json }},
      "gallery_video_looping": {{ section.settings.gallery_video_looping | json }},
      "gallery_hover_zoom": {{ section.settings.gallery_hover_zoom | json }},
      "gallery_click_to_zoom": {{ section.settings.gallery_click_to_zoom | json }},
      "money_format": {{ shop.money_format | strip_html | json }},
      "swatches_enable": {{ settings.swatches_enable | json }},
      "sold_out_options": {{ settings.sold_out_options | json }},
      "select_first_available_variant": {{ section.settings.select_first_available_variant | json }}
    },
    "context": {
      "select_variant": {{ 'product.general.select_variant' | t | json }},
      "product_available": {{ 'product.buttons.add_to_cart' | t | json }},
      "product_sold_out": {{ 'product.buttons.sold_out' | t | json }},
      "product_unavailable": {{ 'product.buttons.unavailable' | t | json }}
    },
    "product": {{ product | json }}
  }
</script>

{% render 'breadcrumbs' %}
{{ 'component-compare-fab.css' | asset_url | stylesheet_tag }}

<section class="product--container" data-product-wrapper id="product-form">
  {%
    render 'product',
    is_product_modal: false,
    show_dynamic_checkout_button: settings.show_dynamic_checkout_button,
    select_first_available_variant: settings.select_first_available_variant,
    gallery_aspect_ratio: section.settings.gallery_aspect_ratio,
    gallery_thumbnail_position: section.settings.gallery_thumbnail_position,
    gallery_image_crop: section.settings.gallery_image_crop,
    gallery_click_to_zoom: section.settings.gallery_click_to_zoom,
    gallery_hover_zoom: section.settings.gallery_hover_zoom
  %}
</section>

<!-- WoodenStreet Conversion Modules (PR #30 Integration) -->
<div class="product-conversion-modules container mx-auto px-4 my-8">
  {% render 'ws-offers-box', product: product %}
  {% render 'ws-delivery-estimator' %}
</div>

{% comment %} Ecommerce-App High-Polish Components Integration {% endcomment %}
<div class="product-additional-content container mx-auto px-4 space-y-20 pb-20">
  
  <!-- Trust Signals Row -->
  <div class="animate-fade-in-up">
    {% render 'whisper-trust-signals' %}
  </div>

  <!-- Review Distribution Summary -->
  <div id="product-reviews-summary" class="animate-fade-in-up">
    {% render 'whisper-rating-distribution', product: product %}
  </div>

  <!-- Detailed Reviews & UGC Split -->
  <div class="grid lg:grid-cols-12 gap-12">
    <div class="lg:col-span-8">
      {% render 'whisper-reviews', product: product, reviews: product.metafields.custom.reviews.value %}
    </div>
    <div class="lg:col-span-4">
      {% render 'whisper-product-specs', product: product %}
    </div>
  </div>

  <!-- UGC Social Proof Gallery -->
  <div class="animate-fade-in-up border-t-2 border-[var(--color-border-primary)] pt-20">
    {% render 'whisper-ugc-gallery' %}
  </div>

</div>

<div
  class="ws-compare-fab"
  data-compare-fab
  data-product-handle="{{ product.handle }}"
  data-product-title="{{ product.title | escape }}"
  data-product-url="{{ product.url }}"
  data-product-image="{{ product.featured_image | img_url: '200x' }}"
  data-product-price="{{ product.price | money_without_trailing_zeros }}"
>
  <button class="ws-compare-fab__button" type="button">
    <span class="ws-compare-fab__icon">â‰¡</span>
    <span class="ws-compare-fab__label">Add to Compare</span>
    <span class="ws-compare-fab__count" aria-live="polite">0</span>
  </button>
  <div class="ws-compare-fab__hint">Compare your picks</div>
</div>

{% render 'ws-sticky-footer', product: product %}
{% render 'judgeme_widgets', widget_type: 'judgeme_review_widget', concierge_install: true, product: product %}

<script>
  $(document).ready(function(){
//      $('.gallery-navigation--scroll-button').hide();
    $('body').on('click','.product-main .product-form--regular .option-value-input',function(){
      var data_val= $(this).val();
      var count =1 ;
      $( ".product-gallery--media-thumbnail" ).each(function() {
        var thumb = $(this).attr('data-thumb');
        console.log(thumb);
        if(thumb == data_val){
          count++;
          console.log(count)
//           if(count > 6){
//             $('.gallery-navigation--scroll-button').show();
//           }
//           else{
//             $('.gallery-navigation--scroll-button').hide();
//           }
          	$(this).css('display','block');
          
        } else{
          $(this).css('display','none');
        }

      });
      
    });
  });

  (function() {
    const compareKey = 'wsCompareList';
    const compareFab = document.querySelector('[data-compare-fab]');

    if (!compareFab) return;

    const label = compareFab.querySelector('.ws-compare-fab__label');
    const count = compareFab.querySelector('.ws-compare-fab__count');
    const button = compareFab.querySelector('.ws-compare-fab__button');
    const productHandle = compareFab.dataset.productHandle;

    const getList = () => {
      try {
        return JSON.parse(localStorage.getItem(compareKey)) || [];
      } catch (error) {
        return [];
      }
    };

    const saveList = (list) => {
      localStorage.setItem(compareKey, JSON.stringify(list));
    };

    const updateUI = () => {
      const list = getList();
      const isActive = list.some((item) => item.handle === productHandle);
      compareFab.dataset.active = String(isActive);
      label.textContent = isActive ? 'Remove from Compare' : 'Add to Compare';
      count.textContent = list.length;
    };

    const toggleCompare = () => {
      const list = getList();
      const existingIndex = list.findIndex((item) => item.handle === productHandle);
      if (existingIndex >= 0) {
        list.splice(existingIndex, 1);
      } else {
        list.push({
          handle: productHandle,
          title: compareFab.dataset.productTitle,
          url: compareFab.dataset.productUrl,
          image: compareFab.dataset.productImage,
          price: compareFab.dataset.productPrice
        });
      }
      saveList(list.slice(0, 6));
      updateUI();
    };

    button.addEventListener('click', toggleCompare);
    window.addEventListener('storage', updateUI);
    updateUI();
  })();
</script>
{% schema %}
{
  "name": "Product information",
  "class": "product--section section--canonical",
  "settings": [
	{
		"type": "text",
		"id": "Shipping_line",
		"label": "Shipping text"
	},
	{
        "id": "upto_time",
        "type": "select",
        "label": "Upto time",
        "options": [
          { "value": "1","label": "1"},
          { "value": "2","label": "2"},
          { "value": "3","label": "3"},
          { "value": "4","label": "4"},
          { "value": "5","label": "5"},
          { "value": "6","label": "6"},
          { "value": "7","label": "7"},
          { "value": "8","label": "8"},
          { "value": "9","label": "9"},
          { "value": "10","label": "10"}        
        ]        
      },	
    {
      "type": "header",
      "content": "Media"
    },
    {
      "type": "paragraph",
      "content": "Learn more about [media types](https://help.shopify.com/en/manual/products/product-media/product-media-types)"
    },
    {
      "type": "select",
      "id": "gallery_aspect_ratio",
      "label": "Aspect ratio",
      "options": [
        { "value": "natural", "label": "Natural" },
        { "value": "short", "label": "Short (4:3)" },
        { "value": "square", "label": "Square (1:1)" },
        { "value": "tall", "label": "Tall (2:3)" }
      ],
      "default": "natural"
    },
    {
      "type": "checkbox",
      "id": "gallery_image_crop",
      "label": "Enable image crop",
      "info": "If disabled, white space will be applied around the image. Has no effect when media aspect ratio is set to natural.",
      "default": false
    },
    {
      "id": "gallery_thumbnail_position",
      "type": "select",
      "label": "Thumbnails position",
      "options": [
        {
          "value": "below",
          "label": "Below main image"
        },
        {
          "value": "left",
          "label": "Left of main image"
        }
      ],
      "default": "below"
    },
    {
      "type": "checkbox",
      "id": "gallery_video_autoplay",
      "label": "Enable video autoplay",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "gallery_video_looping",
      "label": "Enable video looping",
      "default": true
    },
    {
      "id": "gallery_hover_zoom",
      "type": "select",
      "label": "Roll-over image zoom",
      "options": [
        {
          "value": "disabled",
          "label": "Disabled"
        },
        {
          "value": "separate",
          "label": "Enabled (separate box)"
        },
        {
          "value": "replace",
          "label": "Enabled (replace main image)"
        }
      ],
      "info": "Only applies to desktop screen sizes.",
      "default": "disabled"
    },
    {
      "id": "gallery_click_to_zoom",
      "type": "select",
      "label": "Click to zoom image",
      "options": [
        {
          "value": "disabled",
          "label": "Disabled"
        },
        {
          "value": "always",
          "label": "Enabled"
        },
        {
          "value": "desktop",
          "label": "Enabled on desktop only"
        },
        {
          "value": "mobile",
          "label": "Enabled on mobile only"
        }
      ],
      "default": "always",
      "info": "Changes to \"Tap to zoom\" on mobile."
    },
    {
      "type": "paragraph",
      "content": "For the best zoom results, make sure your images are larger than 1600px."
    }
  ],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "title",
      "name": "Title",
      "limit": 1
    },
    {
      "type": "vendor",
      "name": "Vendor",
      "limit": 1
    },
    {
      "type": "price",
      "name": "Price",
      "limit": 1
    },
    {
      "type": "sku",
      "name": "SKU",
      "limit": 1
    },
    {
      "type": "text",
      "name": "Text",
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Text block</p>"
        }
      ]
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1
    },
    {
      "type": "form",
      "name": "Form",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "Customize form features for the product in the products portion of the theme settings."
        }
      ]
    },
    {
      "type": "share",
      "name": "Share",
      "limit": 1
    },
    {
      "type": "short_description",
      "name": "Short Description",
      "limit": 1,
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Text block</p>"
        }
      ]
    },
    {
      "type": "feature_icons",
      "name": "Feature Icons",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Furbicle Promise "
        },
		{
          "type": "header",
          "content": "Icon 1"
        },
		{
          "type": "text",
          "id": "icon_1",
          "label": "Icon 1 URL"
        },
		{
          "type": "text",
          "id": "text_1",
          "label": "Text 1"
        },
		{
          "type": "url",
          "id": "url_1",
          "label": "URL 1"
        },
		{
          "type": "header",
          "content": "Icon 2"
        },
		{
          "type": "text",
          "id": "icon_2",
          "label": "Icon 2 URL"
        },
		{
          "type": "text",
          "id": "text_2",
          "label": "Text 2"
        },
		{
          "type": "url",
          "id": "url_2",
          "label": "URL 2"
        },
		{
          "type": "header",
          "content": "Icon 3"
        },
		{
          "type": "text",
          "id": "icon_3",
          "label": "Icon 3 URL"
        },
		{
          "type": "text",
          "id": "text_3",
          "label": "Text 3"
        },
		{
          "type": "url",
          "id": "url_3",
          "label": "URL 3"
        }
      ]
    },
    {
      "type": "feature_icons_row",
      "name": "Feature Icons Row",
      "limit": 1,
      "settings": [
	    {
          "type": "header",
          "content": "Icon 1"
        },
		{
          "type": "image_picker",
          "id": "icon_1",
          "label": "Icon 1"
        },
		{
          "type": "text",
          "id": "text_1",
          "label": "Text 1"
        },
		{
          "type": "text",
          "id": "btn_1",
          "label": "Button 1"
        },
		{
          "type": "html",
          "id": "html_1",
          "label": "Html 1"
        },
		{
          "type": "url",
          "id": "url_1",
          "label": "URL 1"
        },
	    {
          "type": "header",
          "content": "Icon 2"
        },
		{
          "type": "image_picker",
          "id": "icon_2",
          "label": "Icon 2"
        },
		{
          "type": "text",
          "id": "text_2",
          "label": "Text 2"
        },
		{
          "type": "text",
          "id": "btn_2",
          "label": "Button 2"
        },
		{
          "type": "html",
          "id": "html_2",
          "label": "Html"
        },
		{
          "type": "url",
          "id": "url_2",
          "label": "URL 2"
        },
		{
          "type": "header",
          "content": "Icon 3"
        },
		{
          "type": "image_picker",
          "id": "icon_3",
          "label": "Icon 3"
        },
		{
          "type": "text",
          "id": "text_3",
          "label": "Text 3"
        },
		{
          "type": "text",
          "id": "btn_3",
          "label": "Button 3"
        },
		{
          "type": "html",
          "id": "html_3",
          "label": "Html"
        },
		{
          "type": "url",
          "id": "url_3",
          "label": "URL 3"
        }
      ]
    }
  ]
}

{% endschema %}
