<div
  class="coupon-applier"
  data-coupon-applier
  data-demo-code="WS20"
  data-demo-savings="₹500"
>
  <div class="coupon-applier__header">
    <span class="coupon-applier__title">Apply Best Coupon</span>
    <button class="coupon-applier__toggle" type="button" data-coupon-toggle>
      Apply Best Coupon
    </button>
  </div>

  <div class="coupon-applier__body" data-coupon-body hidden>
    <div class="coupon-applier__input-row">
      <input
        class="coupon-applier__input"
        type="text"
        name="discount"
        placeholder="Enter coupon code"
        value="WS20"
        data-coupon-input
        autocomplete="off"
        aria-label="Coupon code"
      >
      <button class="coupon-applier__apply" type="button" data-coupon-apply>
        Apply
      </button>
    </div>
    <p class="coupon-applier__hint">Try code WS20 for ₹500 savings.</p>
  </div>

  <div class="coupon-applier__success" role="status" aria-live="polite" data-coupon-success hidden>
    ₹500 saved with code WS20!
  </div>
</div>

<script>
  (function() {
    var containers = document.querySelectorAll('[data-coupon-applier]:not([data-coupon-ready])');
    if (!containers.length) return;

    containers.forEach(function(container) {
      container.setAttribute('data-coupon-ready', 'true');
      var toggle = container.querySelector('[data-coupon-toggle]');
      var body = container.querySelector('[data-coupon-body]');
      var applyButton = container.querySelector('[data-coupon-apply]');
      var input = container.querySelector('[data-coupon-input]');
      var success = container.querySelector('[data-coupon-success]');
      var demoCode = container.getAttribute('data-demo-code') || 'WS20';
      var demoSavings = container.getAttribute('data-demo-savings') || '₹500';
      var toggleText = toggle ? toggle.textContent : '';

      var showSuccess = function(codeValue) {
        if (success) {
          var displayCode = codeValue || demoCode;
          success.textContent = demoSavings + ' saved with code ' + displayCode + '!';
          success.hidden = false;
        }
        container.classList.add('is-applied');
        if (toggle) {
          toggle.textContent = 'Change Coupon';
        }
      };

      var applyCode = function() {
        var enteredCode = input && input.value ? input.value.trim() : '';
        if (input) {
          input.value = enteredCode || demoCode;
        }
        if (body) {
          body.hidden = false;
        }
        showSuccess(input ? input.value : demoCode);
      };

      var toggleBody = function() {
        if (!body) return;
        body.hidden = !body.hidden;
        if (!body.hidden && input) {
          input.focus();
        }
      };

      if (toggle) {
        toggle.addEventListener('click', function() {
          if (!body) return;
          if (body.hidden) {
            body.hidden = false;
            if (input) {
              input.value = demoCode;
              input.focus();
            }
            return;
          }
          toggleBody();
        });
      }

      if (applyButton) {
        applyButton.addEventListener('click', applyCode);
      }

      if (input) {
        input.addEventListener('input', function() {
          if (!input.value.trim()) {
            container.classList.remove('is-applied');
            if (toggle) {
              toggle.textContent = toggleText;
            }
            if (success) {
              success.hidden = true;
            }
          }
        });
      }
    });
  })();
</script>
