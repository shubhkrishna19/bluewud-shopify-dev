{%- comment -%}
  WoodenStreet Component: Pincode Serviceability Check (E-02)
{%- endcomment -%}
{{ 'component-pincode-widget.css' | asset_url | stylesheet_tag }}

<div class="ws-delivery-estimator" data-ws-delivery-estimator>
  <h3 class="ws-delivery-estimator__title">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
    </svg>
    Check Delivery Estimate
  </h3>
  <div class="ws-delivery-estimator__row">
    <input 
      class="ws-delivery-estimator__input" 
      type="text" 
      placeholder="Enter Pincode (e.g. 560001)" 
      maxlength="6" 
      pattern="\d*"
      aria-label="Enter Pincode">
    <button class="ws-delivery-estimator__button" type="button">Check</button>
  </div>
  <p class="ws-delivery-estimator__note" role="status"></p>
</div>

<script>
  (function() {
    document.querySelectorAll('[data-ws-delivery-estimator]').forEach(widget => {
      const input = widget.querySelector('input');
      const btn = widget.querySelector('button');
      const note = widget.querySelector('.ws-delivery-estimator__note');

      function checkPincode() {
        const val = input.value.trim();
        if (val.length !== 6 || isNaN(val)) {
          note.textContent = "Please enter a valid 6-digit pincode.";
          note.className = 'ws-delivery-estimator__note error';
          return;
        }

        // Mock Logic: Even = Success, Odd = No Delivery
        // In real app, fetch /apps/check_pincode?code=val
        btn.textContent = '...';
        setTimeout(() => {
          btn.textContent = 'Check';
          if (parseInt(val) % 2 === 0) {
              const deliveryDate = new Date();
              deliveryDate.setDate(deliveryDate.getDate() + 5);
              const dateString = deliveryDate.toLocaleDateString('en-US', { day: 'numeric', month: 'short' });
              
              note.textContent = `Success! Delivery by ${dateString} is available.`;
              note.className = 'ws-delivery-estimator__note success';
          } else {
              note.textContent = `Sorry, delivery not available to ${val}.`;
              note.className = 'ws-delivery-estimator__note error';
          }
        }, 800);
      }

      btn.addEventListener('click', checkPincode);
      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') checkPincode();
      });
    });
  })();
</script>
