<div class="woodenstreet-delivery" data-delivery-estimator>
  <div class="woodenstreet-delivery__title">Check delivery availability</div>
  <div class="woodenstreet-delivery__form">
    <input
      class="woodenstreet-delivery__input"
      type="text"
      inputmode="numeric"
      pattern="[0-9]*"
      maxlength="6"
      placeholder="Enter pincode"
      aria-label="Enter pincode"
      data-delivery-input
    >
    <button class="woodenstreet-delivery__button" type="button" data-delivery-submit>
      Check
    </button>
  </div>
  <div class="woodenstreet-delivery__result" data-delivery-result aria-live="polite">
    Enter your pincode to see delivery estimates.
  </div>
</div>

<script>
  (() => {
    const containers = document.querySelectorAll('[data-delivery-estimator]');
    if (containers.length === 0 || window.__woodenstreetDeliveryEstimatorInitialized) {
      return;
    }
    window.__woodenstreetDeliveryEstimatorInitialized = true;
    const storageKey = 'woodenstreet:delivery-estimator:pincode';

    const renderEstimate = (result, pincode) => {
      if (!pincode || pincode.length < 5) {
        result.textContent = 'Enter a valid pincode to see delivery estimates.';
        return;
      }
      result.textContent = `Delivery available. Estimated dispatch in 2-4 days for ${pincode}.`;
    };

    containers.forEach((container) => {
      const input = container.querySelector('[data-delivery-input]');
      const button = container.querySelector('[data-delivery-submit]');
      const result = container.querySelector('[data-delivery-result]');

      const saved = window.localStorage.getItem(storageKey);
      if (saved) {
        input.value = saved;
        renderEstimate(result, saved);
      }

      const handleSubmit = () => {
        const pincode = input.value.trim();
        window.localStorage.setItem(storageKey, pincode);
        renderEstimate(result, pincode);
      };

      button.addEventListener('click', handleSubmit);
      input.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
          event.preventDefault();
          handleSubmit();
        }
      });
    });
  })();
</script>
